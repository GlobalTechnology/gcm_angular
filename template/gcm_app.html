<div ng-controller="gcmController">

	<script type="text/ng-template" id="field_renderer.html">
		<a href="" ng-click="loadAssignment(a)">{{a.name}}</a>
		<ul>
			<li ng-repeat="a in a.sub_ministries" ng-include="'field_renderer.html'"></li>
		</ul>
	</script>

	<nav class="navbar navbar-inverse navbar-static-top">
		<div class="container">


			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<span class="ministry-title" ng-hide="has_assignment">GCM APP</span>
				<ul class="nav navbar-nav" ng-show="has_assignment">

					<li class="dropdown">

						<a href="" class="dropdown-toggle  ministry-title" data-toggle="dropdown">{{assignment.name}}<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
							<li ng-repeat="a in assignments" ng-include="'field_renderer.html'"></li>
							<li class="divider"></li>
							<li>
								<a href="" data-toggle="modal" data-target="#newAssignment">Add another location / ministry</a>
							</li>

						</ul>
					</li>
					<li class="dropdown">
						<a href="" class="dropdown-toggle" data-toggle="dropdown">
							{{current_mcc}}<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
							<li ng-repeat="(mcc_code, mcc_name) in assignment.mccs">
								<a href="" ng-click="$parent.current_mcc=mcc_name">{{mcc_name}}</a></li>
						</ul>
					</li>


					<li>
						<a href="" ng-click="prevPeriod()">&lt;&lt;</a>
					</li>

					<li class="dropdown">
						<a href="" class="dropdown-toggle" data-toggle="dropdown"> {{current_period}}
							<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">

							<li ng-repeat="p in periods"><a href="" ng-click="$parent.current_period=p;">{{p}}</a>
							</li>

						</ul>
					</li>
					<li>
						<a href="" ng-click="nextPeriod()">&gt;&gt;</a>
					</li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="">{{user.person.cas_username}}</a></li>
					<li><a href="https://thekey.me/cas/logout">logout</a></li>
				</ul>
			</div>


		</div>
	</nav>
	<div class="container">
		<div ng-show="has_assignment">
			<ul class="nav nav-tabs" role="tablist" id="myTab" class="map-ministries">
				<li ng-class="{active: $location.path() === '/map'}"><a href="#/map" data-target="#">Church</a></li>
				<li ng-class="{active: $location.path() === '/measurements'}">
					<a href="#/measurements" data-target="#">Measurements</a></li>
				<li ng-class="{active: $location.path() === '/admin'}">
					<a href="#/admin" data-target="#" ng-show="assignment.team_role === 'leader' || assignment.team_role === 'inherited_leader'">Admin</a>
				</li>
			</ul>

			<!-- Example row of columns -->
			<div class="row">
				<div class="col-md-12">
					<!--Let it up to the Angular route provider to populate the view in the directive-->
					<div ng-view></div>
					<div class="spinner" ng-hide="is_loaded">
						<div class="spinner-container container1">
							<div class="circle1"></div>
							<div class="circle2"></div>
							<div class="circle3"></div>
							<div class="circle4"></div>
						</div>
						<div class="spinner-container container2">
							<div class="circle1"></div>
							<div class="circle2"></div>
							<div class="circle3"></div>
							<div class="circle4"></div>
						</div>
						<div class="spinner-container container3">
							<div class="circle1"></div>
							<div class="circle2"></div>
							<div class="circle3"></div>
							<div class="circle4"></div>
						</div>
					</div>
				</div>
			</div>

		</div>


		<footer>
			<p>&copy; CCCi 2014</p>
		</footer>
	</div>
	<!-- /container -->

	<div class="modal fade" id="newAssignment" tabindex="-1" role="dialog" aria-labelledby="newAssignmentLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
					</button>
					<h4 class="modal-title" id="newAssignmentLabel">Join Ministry/Team</h4>

					<p class="bg-info">
						You can request create a provisional assignment to ministry/team here.
						Until this request has been approved by a leader of this team/ministry, your access will be read only.
						You can submit personal ministry measurements, but these values won't be included until your request has been approved.
					</p>
				</div>
				<div class="modal-body form-horizontal">
					<div class="form-group">
						<label for="tbUserName" class="col-sm-4 control-label">Ministry/Team:</label>

						<div class="col-sm-8">
							<div id="min_lookup">

								<input id="tbMinistry" type="text" class=" form-control" placeholder="Ministry/Team" ng-model="new_assignment.min_name"
									   typeahead="min.name for min in ministries | filter:$viewValue | limitTo:8"
									   typeahead-loading="loadingMinistries"
									   typeahead-min-length="2" />
								<i ng-show="loadingMinistries" class="glyphicon glyphicon-refresh"></i>
							</div>

							<p class="help-block">Start typing to search for ministry</p>
						</div>

					</div>


				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="newAssignment()">Join</button>
				</div>
			</div>
		</div>
	</div>
</div>
